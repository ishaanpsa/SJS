<!doctype html>
<html lang="pa" dir="ltr">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Sarbloh Japji Sahib</title>

<!-- Favicons -->
<link rel="icon" type="image/png" sizes="32x32" href="favicons/favicon-32.png">
<link rel="icon" type="image/png" sizes="64x64" href="favicons/favicon-64.png">
<link rel="icon" type="image/png" sizes="192x192" href="favicons/favicon-192.png">
<link rel="apple-touch-icon" sizes="180x180" href="favicons/favicon-180.png">
<meta name="theme-color" content="#0b234a">

<style>
  :root{ --maxw:1000px; --muted:#94a3b8; --border:#0a2a66; --blue:#0b234a; --blue2:#0e2b5a; --btn:#173b8c; }
  body{ margin:0; font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Arial; color:#e5e7eb; background:#0b1220; }
  main{ margin:0 auto; max-width:var(--maxw); padding:12px; padding-bottom:132px; } /* more bottom space for audio+nav */

  .stage{
    position:relative;
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:calc(100svh - 180px); /* account for audio bar + nav */
  }

  img{
    display:block;
    max-width:95%;
    height:auto;
    border:1px solid #1e293b;
    border-radius:.6rem;
    background:#fff;
    margin-left:auto;
    margin-right:auto;
    box-shadow:0 4px 16px rgba(0,0,0,.4);
  }

  /* Fit: Height — preserve aspect ratio, no zoom */
  .fit-h img{
    width:auto;
    height:calc(100svh - 180px);
    max-height:calc(100svh - 180px);
    max-width:none;
    transform:none !important;
  }

  /* On small screens, enlarge only in Fit: Width */
  @media (max-width: 600px) {
    .stage:not(.fit-h) img {
      max-width:115%;
      transform:scale(1.15);
      transform-origin:center top;
    }
  }

  /* Audio bar (compact) */
  .audio{
    position:fixed; left:0; right:0; bottom:48px; z-index:11; /* sits above bottom nav */
    display:flex; align-items:center; gap:.6rem;
    height:50px; padding:0 12px env(safe-area-inset-bottom);
    background: #0e2b5a; border-top:1px solid #0a2550;
  }
  .audio button{
    padding:.35rem .6rem; border:1px solid #2a478e; border-radius:.5rem; background:#173b8c; color:#fff; font:inherit; cursor:pointer;
    min-width:64px;
  }
  .time{ font-variant-numeric: tabular-nums; color:#dbeafe; font-size:.95rem; }
  .bar{ flex:1; display:flex; align-items:center; gap:.5rem; }
  input[type="range"]{
    -webkit-appearance:none; appearance:none; width:100%; height:6px; border-radius:999px; background:#1f3c78; outline:none;
  }
  input[type="range"]::-webkit-slider-thumb{
    -webkit-appearance:none; appearance:none; width:16px; height:16px; border-radius:50%; background:#ffffff; border:2px solid #173b8c;
    margin-top:-5px;
  }
  input[type="range"]::-moz-range-thumb{
    width:16px; height:16px; border-radius:50%; background:#ffffff; border:2px solid #173b8c;
  }

  /* Slim bottom bar */
  .nav{
    position:fixed; left:0; right:0; bottom:0; z-index:10;
    display:flex; align-items:center; justify-content:space-between;
    height:48px; padding:0 12px env(safe-area-inset-bottom);
    border-top:1px solid var(--border);
    background: var(--blue); color:#fff;
  }
  .nav small{ color:#fff; font-weight:700; }
  .btn{
    padding:.35rem .6rem; border:1px solid #2a478e; border-radius:.5rem;
    background: var(--btn); color:#fff; font:inherit; cursor:pointer;
  }
  .btn:disabled{ opacity:.6; cursor:not-allowed }

  /* Floating arrows */
  .fab{
    position:fixed; bottom:110px; width:42px; height:42px; border-radius:999px;
    display:grid; place-items:center; border:1px solid #334155;
    background:#0b234acc; color:#fff; backdrop-filter:saturate(1.1) blur(4px); cursor:pointer;
  }
  .fab-left{ left:10px; } .fab-right{ right:10px; }

  .tip{ color:#94a3b8; font-size:.9rem; margin:4px 0 0 2px; }
  @media (max-width:560px){ body{font-size:15px} }
</style>
<body>
  <main>
    <div class="stage" id="stage">
      <img id="pageImg" alt="PDF page 1" loading="eager">
    </div>
    <div id="err" class="tip" style="display:none"></div>
    <div class="tip">Swipe ◀/▶, or tap arrows. Use “Fit” for tall pages.</div>
  </main>

  <!-- floating arrows -->
  <button class="fab fab-left"  id="prevFab"  aria-label="Previous page">◀</button>
  <button class="fab fab-right" id="nextFab"  aria-label="Next page">▶</button>

  <!-- audio bar -->
  <div class="audio" role="region" aria-label="Audio player">
    <button id="playPause">Play</button>
    <div class="bar">
      <span class="time" id="cur">0:00</span>
      <input id="seek" type="range" min="0" max="1000" value="0" step="1" aria-label="Seek">
      <span class="time" id="dur">0:00</span>
    </div>
    <audio id="audio" preload="metadata"></audio>
  </div>

  <!-- slim bottom bar -->
  <div class="nav">
    <small id="pageIndicator">Page 1 / 10</small>
    <button class="btn" id="fitToggle">Fit: Width</button>
  </div>

<script>
  /* =================== VIEWER =================== */
  const NUM_PAGES = 10;
  const BASE = "assets";
  const fname = n => `page-${String(n).padStart(3,"0")}.png`;
  const bust = `?v=${Date.now()}`;

  let idx = 0;
  const img  = document.getElementById('pageImg');
  const ind  = document.getElementById('pageIndicator');
  const err  = document.getElementById('err');
  const stage= document.getElementById('stage');
  const fitToggle = document.getElementById('fitToggle');
  const prevFab = document.getElementById('prevFab');
  const nextFab = document.getElementById('nextFab');

  const urlFor = n => `${BASE}/${fname(n)}${bust}`;
  const showErr = m => { err.style.display='block'; err.textContent=m; console.error(m); }
  const clearErr= () => { err.style.display='none'; err.textContent=''; }

  function update(){
    clearErr();
    const n = idx+1;
    img.src = urlFor(n);
    img.alt = `PDF page ${n}`;
    ind.textContent = `Page ${n} / ${NUM_PAGES}`;
    prevFab.disabled = (idx===0);
    nextFab.disabled = (idx===NUM_PAGES-1);
    location.hash = `#p${n}`;
  }

  img.addEventListener('error', ()=>{
    showErr(`Couldn't load: ${img.src.replace(location.origin,'')}. Check ${BASE}/${fname(idx+1)} (case-sensitive).`);
  });

  function prev(){ if(idx>0){ idx--; update(); } }
  function next(){ if(idx<NUM_PAGES-1){ idx++; update(); } }
  prevFab.addEventListener('click', prev);
  nextFab.addEventListener('click', next);
  window.addEventListener('keydown', e=>{
    if(e.key==='ArrowLeft')  prev();
    if(e.key==='ArrowRight') next();
  });

  // Fit toggle
  let fit='width';
  function applyFit(){
    if(fit==='height'){ stage.classList.add('fit-h');  fitToggle.textContent='Fit: Height'; }
    else              { stage.classList.remove('fit-h');fitToggle.textContent='Fit: Width'; }
  }
  fitToggle.addEventListener('click', ()=>{ fit = (fit==='width'?'height':'width'); applyFit(); });

  // swipe
  let sx=0, sy=0, moved=false; const TH=40;
  stage.addEventListener('touchstart', e=>{ const t=e.changedTouches[0]; sx=t.clientX; sy=t.clientY; moved=false; }, {passive:true});
  stage.addEventListener('touchmove', ()=>{ moved=true; }, {passive:true});
  stage.addEventListener('touchend', e=>{
    if(!moved) return;
    const t=e.changedTouches[0]; const dx=t.clientX-sx, dy=t.clientY-sy;
    if(Math.abs(dx)>Math.abs(dy) && Math.abs(dx)>TH){ dx<0 ? next() : prev(); }
  }, {passive:true});

  (function init(){
    const m = location.hash.match(/#p(\d+)/i);
    if(m){ idx = Math.min(Math.max(parseInt(m[1],10)-1,0), NUM_PAGES-1); }
    applyFit();
    update();
  })();

  /* =================== AUDIO =================== */
  // Put your file at /audio/track.mp3 or change this path:
  const AUDIO_SRC = "audio/track.mp3";

  const audio = document.getElementById('audio');
  const playPause = document.getElementById('playPause');
  const seek = document.getElementById('seek');
  const cur = document.getElementById('cur');
  const dur = document.getElementById('dur');

  audio.src = AUDIO_SRC;

  function fmt(t){
    if(!isFinite(t)) return "0:00";
    const m = Math.floor(t/60);
    const s = Math.floor(t%60).toString().padStart(2,"0");
    return `${m}:${s}`;
  }

  audio.addEventListener('loadedmetadata', ()=>{
    dur.textContent = fmt(audio.duration);
  });

  // update progress
  audio.addEventListener('timeupdate', ()=>{
    if(audio.duration){
      seek.value = Math.round((audio.currentTime / audio.duration) * 1000);
      cur.textContent = fmt(audio.currentTime);
    }
  });

  // seek on input
  let seeking = false;
  seek.addEventListener('input', ()=>{
    if(audio.duration){
      seeking = true;
      audio.currentTime = (seek.value / 1000) * audio.duration;
      cur.textContent = fmt(audio.currentTime);
    }
  });
  seek.addEventListener('change', ()=> seeking = false);

  // play/pause
  function updateBtn(){
    playPause.textContent = audio.paused ? "Play" : "Pause";
  }
  playPause.addEventListener('click', ()=>{
    if(audio.paused) audio.play(); else audio.pause();
  });
  audio.addEventListener('play', updateBtn);
  audio.addEventListener('pause', updateBtn);
  audio.addEventListener('ended', ()=>{ audio.currentTime = 0; updateBtn(); });

  // Optional: Media Session (lock screen controls on Android)
  if ('mediaSession' in navigator) {
    navigator.mediaSession.metadata = new MediaMetadata({ title: "Sarbloh Japji Sahib", artist: "", artwork: [] });
    navigator.mediaSession.setActionHandler('play', ()=>audio.play());
    navigator.mediaSession.setActionHandler('pause', ()=>audio.pause());
    navigator.mediaSession.setActionHandler('seekto', e=>{ if(e.seekTime!=null) audio.currentTime = e.seekTime; });
  }
</script>
</body>
</html>
